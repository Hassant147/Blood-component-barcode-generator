<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Blood component barcode generator — Free</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#0b0c0f; --panel:#11131a; --card:#171a23;
    --text:#e5e7eb; --muted:#9aa3b2; --accent:#8b5cf6;
    --err:#ef4444; --ok:#22c55e;
    /* CSS bag palette */
    --blood-red:#8a0e0e; --port-grey:#b0b0b0; --label-white:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:14px/1.35 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    display:grid; grid-template-columns:420px 1fr; gap:16px;
    min-height:100vh; padding:16px;
  }
  header{ grid-column:1/-1; display:flex; gap:10px; align-items:center }
  h1{ font-size:20px; margin:0 }

  .left{
    background:var(--panel); border-radius:16px; padding:16px;
    display:flex; flex-direction:column; gap:14px;
  }
  .group{ background:var(--card); border-radius:12px; padding:12px }
  label{ display:block; font-size:12px; margin:6px 0 }
  input,select{
    width:100%; padding:8px 10px; border-radius:8px;
    border:1px solid #262b3d; background:#0e1119; color:var(--text);
  }
  .row{ display:grid; grid-template-columns:2fr 1fr; gap:8px; align-items:end }
  .actions{ display:flex; flex-wrap:wrap; gap:10px }
  button{
    padding:10px 12px; border-radius:10px; border:1px solid #303548;
    background:#1b2032; color:#e5e7eb; cursor:pointer;
  }
  button.primary{ background:var(--accent); border-color:#7c3aed }
  button.success{ background:var(--ok); border-color:#16a34a; color:#04130a }
  .right{
    background:#080a10; border-radius:16px; padding:16px;
    display:flex; flex-direction:column; gap:10px;
  }
  .preview-shell{
    display:flex; justify-content:center; align-items:center;
    background:#0a0d14; border:1px dashed #2a3044;
    border-radius:12px; height:70vh; overflow:auto;
  }
  .error{ color:var(--err); font-size:12px; min-height:1.2em }
  .mono{ font-family:ui-monospace,Consolas,monospace }
  .labelText{ font:700 16px/1 Inter,Arial; color:#111 }
  /* Outline variant for HTML text (approximate SVG stroke) */
  .labelText.outline{
    color:#fff;
    -webkit-text-stroke: 2px #111;
    text-shadow:
      1px 0 0 #111,
      -1px 0 0 #111,
      0 1px 0 #111,
      0 -1px 0 #111;
  }
  .caption{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  /* Zones inside CSS label */
  .barcode-zone{ position:absolute; }
  .barcode-zone canvas{ display:block; width:100%; height:auto }
  .barcode-zone .caption{ font-size:12px; margin-top:4px }
  /* CSS-bag specific colors */
  :root{
    --plasma-yellow: #d6a500;
  }
  small.hint{ color:var(--muted); display:block; margin-top:6px }
  #bag{ width:auto !important; height:100% !important; max-height:100%; }
  @media (max-width:900px){
    body{ grid-template-columns:1fr; }
    .preview-shell{ height:60vh }
  }
  /* CSS Blood Bag (preview background) */
  .blood-bag-wrapper {
    position: relative;
    width: 400px;
    height: 450px;
    filter: drop-shadow(0 4px 10px rgba(0,0,0,0.15));
  }
  .blood-bag-body {
    width: 100%;
    height: 100%;
    background-color: var(--blood-red);
    border-radius: 40px 40px 60px 60px;
    position: absolute;
    bottom: 0;
    z-index: 2;
  }
  .blood-bag-label {
    position: absolute;
    width: 380px;
    height: 320px;
    background-color: var(--label-white);
    border-radius: 20px;
    z-index: 3;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin-top: 20px;
    box-sizing: border-box;
    padding: 0; /* content positioned by JS */
    color: #333;
    font-size: 14px;
  }
  .port-center-left, .port-center-right {
    position: absolute;
    width: 25px;
    height: 30px;
    background-color: var(--blood-red);
    z-index: 3;
    top: -30px;
    border-radius: 5px 5px 0 0;
  }
  .port-center-left { left: 150px; }
  .port-center-right { right: 150px; }
  .port-outer-left, .port-outer-right {
    position: absolute;
    width: 35px;
    height: 50px;
    background-color: var(--port-grey);
    z-index: 1;
    top: -50px;
    border-radius: 10px 10px 0 0;
  }
  .port-outer-left { left: 60px; }
  .port-outer-right { right: 60px; }
</style>
</head>
<body>
<header>
  <h1>Blood component barcode generator</h1>
  <span style="font-size:12px;color:#9aa3b2;">Free edition — limited to Red Cells in Additive Solution, LD</span>
</header>

<aside class="left">
  <div class="group">
    <label for="product">Product</label>
    <select id="product"></select>
    <small class="hint">This contains only the Red Cells in Additive Solution, LD product.</small>
  </div>

  <div class="group">
    <label>Donation / Unit Number</label>
    <div class="row">
      <input id="donation" type="text" class="mono"/>
      <div style="font-size:18px;color:var(--muted);">
      <span id="donationChk" class="mono">–</span>
      </div>
    </div>
    <div id="donation-error" class="error"></div>
    <small class="hint">
      Type the donation number without the check character. It will be auto-calculated.
    </small>
  </div>

  <div class="group">
    <label>Blood Group</label>
    <select id="blood">
      <option value="5100" data-text="O RhD Positive" data-style="solid">O RhD Positive</option>
      <option value="9500" data-text="O RhD Negative" data-style="outline">O RhD Negative</option>
      <option value="6200" data-text="A RhD Positive" data-style="solid">A RhD Positive</option>
      <option value="0600" data-text="A RhD Negative" data-style="outline">A RhD Negative</option>
      <option value="7300" data-text="B RhD Positive" data-style="solid">B RhD Positive</option>
      <option value="1700" data-text="B RhD Negative" data-style="outline">B RhD Negative</option>
      <option value="8400" data-text="AB RhD Positive" data-style="solid">AB RhD Positive</option>
      <option value="2800" data-text="AB RhD Negative" data-style="outline">AB RhD Negative</option>
    </select>
  </div>

  <div class="group">
    <label>Expiry Date</label>
    <input id="expiry" type="date" inputmode="numeric"/>
    <div id="expiry-error" class="error"></div>
    <small class="hint">Enter the expiry date in the format DD/MM/YYYY or select using the calendar</small>
  </div>

  <div class="actions">
    <button id="generate" class="primary">Generate</button>
    <button id="dlSvg">Download SVG</button>
    <button id="dlPng">Download PNG</button>
  </div>

  <!-- Debug payloads commented out per request
  <div class="group">
    <div class="mono" style="font-size:12px;color:var(--muted)">
      Expected payloads:<br>
      Donation: <span id="dbg-donation"></span><br>
      Product: <span id="dbg-product"></span><br>
      Blood: <span id="dbg-blood"></span><br>
      Expiry: <span id="dbg-expiry"></span>
    </div>
  </div>
  -->
</aside>

<main class="right">
  <div class="preview-shell">
    <div id="bagPreview" class="blood-bag-wrapper">
      <div class="port-outer-left"></div>
      <div class="port-outer-right"></div>

      <div class="blood-bag-body"></div>

      <div class="port-center-left"></div>
      <div class="port-center-right"></div>

      <div class="blood-bag-label" id="cssLabel">
        <!-- Zones positioned inside the white label -->
        <div id="zoneDonation" class="barcode-zone"></div>
        <div id="zoneBlood" class="barcode-zone"></div>
        <div id="zoneProduct" class="barcode-zone"></div>
        <div id="zoneExpiry" class="barcode-zone"></div>
      </div>
    </div>
  </div>
</main>

<canvas id="scratch" style="display:none"></canvas>

<script src="catalogue-free.js"></script>
<script src="js/util.js"></script>
<script src="js/date.js"></script>
<script src="js/checksum.js"></script>
<script src="js/code128.js"></script>
<script src="js/preview.js"></script>
<script src="js/app.js"></script>
</body>
</html>
